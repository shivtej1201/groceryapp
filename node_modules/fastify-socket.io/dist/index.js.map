{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { FastifyInstance, FastifyPluginAsync } from 'fastify'\nimport fp from 'fastify-plugin'\nimport { Server, ServerOptions } from 'socket.io'\n\nexport type FastifySocketioOptions = Partial<ServerOptions> & {\n  preClose?: (done: Function) => void\n}\n\nconst fastifySocketIO: FastifyPluginAsync<FastifySocketioOptions> = fp(\n  async function (fastify, opts: FastifySocketioOptions) {\n    function defaultPreClose(done: Function) {\n      (fastify as any).io.local.disconnectSockets(true)\n      done()\n    }\n    fastify.decorate('io', new Server(fastify.server, opts))\n    fastify.addHook('preClose', (done) => {\n      if (opts.preClose) {\n        return opts.preClose(done)\n      }\n      return defaultPreClose(done)\n    })\n    fastify.addHook('onClose', (fastify: FastifyInstance, done) => {\n      (fastify as any).io.close()\n      done()\n    })\n  },\n  { fastify: '>=4.x.x', name: 'fastify-socket.io' },\n)\n\nexport default fastifySocketIO\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,4BAAe;AACf,oBAAsC;AAMtC,MAAM,sBAA8D,sBAAAA;AAAA,EAClE,eAAgB,SAAS,MAA8B;AACrD,aAAS,gBAAgB,MAAgB;AACvC,MAAC,QAAgB,GAAG,MAAM,kBAAkB,IAAI;AAChD,WAAK;AAAA,IACP;AACA,YAAQ,SAAS,MAAM,IAAI,qBAAO,QAAQ,QAAQ,IAAI,CAAC;AACvD,YAAQ,QAAQ,YAAY,CAAC,SAAS;AACpC,UAAI,KAAK,UAAU;AACjB,eAAO,KAAK,SAAS,IAAI;AAAA,MAC3B;AACA,aAAO,gBAAgB,IAAI;AAAA,IAC7B,CAAC;AACD,YAAQ,QAAQ,WAAW,CAACC,UAA0B,SAAS;AAC7D,MAACA,SAAgB,GAAG,MAAM;AAC1B,WAAK;AAAA,IACP,CAAC;AAAA,EACH;AAAA,EACA,EAAE,SAAS,WAAW,MAAM,oBAAoB;AAClD;AAEA,IAAO,cAAQ;","names":["fp","fastify"]}